parameters:
  platform: ''
  platformStr: ''
  graphics: 'NANOVG'
  buildAllProjects: false
  selectedProjects: ''  # Comma-separated list of specific projects to build

# Helper function to determine if a project should be built:
# - If selectedProjects is specified, build only those projects
# - If selectedProjects is empty and buildAllProjects is true, build all projects
# - If both are empty/false, build only IPlugEffect (minimal CI)

steps:
# IPlugEffect - always built unless specific projects are selected (and it's not in the list)
- ${{ if or(eq(parameters.selectedProjects, ''), contains(parameters.selectedProjects, 'IPlugEffect')) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugEffect
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugEffect_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugInstrument
- ${{ if or(contains(parameters.selectedProjects, 'IPlugInstrument'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugInstrument
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugInstrument_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugMidiEffect
- ${{ if or(contains(parameters.selectedProjects, 'IPlugMidiEffect'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugMidiEffect
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugMidiEffect_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugControls
- ${{ if or(contains(parameters.selectedProjects, 'IPlugControls'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugControls
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugControls_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugResponsiveUI
- ${{ if or(contains(parameters.selectedProjects, 'IPlugResponsiveUI'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugResponsiveUI
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugResponsiveUI_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugChunks
- ${{ if or(contains(parameters.selectedProjects, 'IPlugChunks'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugChunks
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugChunks_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugSideChain
- ${{ if or(contains(parameters.selectedProjects, 'IPlugSideChain'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugSideChain
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugSideChain_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugSurroundEffect
- ${{ if or(contains(parameters.selectedProjects, 'IPlugSurroundEffect'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugSurroundEffect
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugSurroundEffect_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugDrumSynth
- ${{ if or(contains(parameters.selectedProjects, 'IPlugDrumSynth'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugDrumSynth
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugDrumSynth_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugConvoEngine
- ${{ if or(contains(parameters.selectedProjects, 'IPlugConvoEngine'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugConvoEngine
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugConvoEngine_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugOSCEditor
- ${{ if or(contains(parameters.selectedProjects, 'IPlugOSCEditor'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugOSCEditor
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugOSCEditor_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugVisualizer
- ${{ if or(contains(parameters.selectedProjects, 'IPlugVisualizer'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugVisualizer
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugVisualizer_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugReaperPlugin
- ${{ if or(contains(parameters.selectedProjects, 'IPlugReaperPlugin'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugReaperPlugin
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugReaperPlugin_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugCocoaUI
- ${{ if or(contains(parameters.selectedProjects, 'IPlugCocoaUI'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugCocoaUI
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugCocoaUI_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugSwiftUI
- ${{ if or(contains(parameters.selectedProjects, 'IPlugSwiftUI'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugSwiftUI
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugSwiftUI_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugWebUI
- ${{ if or(contains(parameters.selectedProjects, 'IPlugWebUI'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugWebUI
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugWebUI_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugP5js
- ${{ if or(contains(parameters.selectedProjects, 'IPlugP5js'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugP5js
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugP5js_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IPlugSvelteUI
- ${{ if or(contains(parameters.selectedProjects, 'IPlugSvelteUI'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IPlugSvelteUI
      path: 'Examples'
      graphics: ${{parameters.graphics}}
      artifactName: IPlugSvelteUI_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IGraphicsStressTest (Tests)
- ${{ if or(contains(parameters.selectedProjects, 'IGraphicsStressTest'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IGraphicsStressTest
      path: 'Tests'
      graphics: ${{parameters.graphics}}
      artifactName: IGraphicsStressTest_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# IGraphicsTest (Tests)
- ${{ if or(contains(parameters.selectedProjects, 'IGraphicsTest'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: IGraphicsTest
      path: 'Tests'
      graphics: ${{parameters.graphics}}
      artifactName: IGraphicsTest_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# MetaParamTest (Tests)
- ${{ if or(contains(parameters.selectedProjects, 'MetaParamTest'), and(eq(parameters.selectedProjects, ''), eq(parameters.buildAllProjects, true))) }}:
  - template: ${{parameters.platform}}
    parameters:
      name: MetaParamTest
      path: 'Tests'
      graphics: ${{parameters.graphics}}
      artifactName: MetaParamTest_${{parameters.graphics}}
      platformStr: ${{parameters.platformStr}}

# External Project
# - template: ${{parameters.platform}}
#   parameters:
#     name: MyProject # the name of the iPlug2 project folder ... e.g. what you specified when duplicating IPlugEffect
#     path: Projects  # the name of the folder that contains the project, which should be at the top level of the iPlug2 setup
#                     # e.g. Examples/Tests or Projects if you want to separate external projects
#     graphics: ${{parameters.graphics}} # here you can specify a graphics backend, either, 'NANOVG', 'SKIA'
#     artifactName: MyProject # How should the built artifact be named? If building for multiple graphics backends, you can customize this, using ${{parameters.graphics}}
#     srcRepo: https://$GITHUB_USER:$GITHUB_PAT@github.com/MyProject.git # the git repository to clone into path/name for building
#     srcBranch: master # the branch to clone for building

#     #WEB AUDIO MODULE publishing via git
#     publishRepo: https://$GITHUB_USER:$GITHUB_PAT@github.com/MyProject.git # the git repository to publish the WAM to
#     publishBranch: gh-pages # the branch to publish the WAM to
#     publishOrigin: https://iplug2.github.io/MyProject/ # the origin URL where the WAM will be hosted. NOTE: should end with /
#     user: $GITHUB_USER # the git username to commit with when publishing
#     email: $GIT_EMAIL # the git email address to commit with when publishing
