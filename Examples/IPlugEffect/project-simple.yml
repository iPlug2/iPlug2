# XcodeGen project spec for IPlugEffect (simplified version using shared templates)
# Generate with: xcodegen generate --spec project-simple.yml
#
# This version demonstrates using the shared iPlug2 templates from Scripts/xcodegen/

name: IPlugEffect-macOS

############################################
# Include shared iPlug2 templates
############################################
include:
  - path: ../../Scripts/xcodegen/iplug2-common.yml

############################################
# Options
############################################
options:
  bundleIdPrefix: com.AcmeInc
  deploymentTarget:
    macOS: "10.13"
  xcodeVersion: "15.0"
  createIntermediateGroups: true
  defaultConfig: Release

############################################
# Project-level config files
############################################
configFiles:
  Debug: config/IPlugEffect-mac.xcconfig
  Release: config/IPlugEffect-mac.xcconfig
  Tracer: config/IPlugEffect-mac.xcconfig

############################################
# Build configurations
############################################
configs:
  Debug: debug
  Release: release
  Tracer: release

############################################
# File Groups
############################################
fileGroups:
  - config
  - resources
  - scripts

############################################
# Custom Settings for this project
############################################
settings:
  base:
    BINARY_NAME: IPlugEffect
    # Required: Path from this project to iPlug2 root
    IPLUG2_ROOT: ../..
    # Required: SWELL requires manual memory management
    CLANG_ENABLE_OBJC_ARC: NO
    # Base include paths from xcconfig
    HEADER_SEARCH_PATHS: $(IPLUG_INC_PATHS) $(EXTRA_INC_PATHS)

############################################
# Targets
############################################
targets:

  # VST3 Plugin
  VST3:
    platform: macOS
    type: bundle
    settings:
      PRODUCT_NAME: $(BINARY_NAME)
      INFOPLIST_FILE: resources/IPlugEffect-VST3-Info.plist
      WRAPPER_EXTENSION: vst3
      DSTROOT: $(VST3_PATH)
      INSTALL_PATH: /
      CODE_SIGN_IDENTITY: ""
      PRODUCT_BUNDLE_IDENTIFIER: com.AcmeInc.vst3.$(BINARY_NAME)
      SKIP_INSTALL: NO
      GENERATE_PKGINFO_FILE: YES
      DEPLOYMENT_LOCATION: YES
      HEADER_SEARCH_PATHS:
        - $(inherited)
        - $(SRCROOT)
        - $(VST3_SDK)
        - $(IPLUG2_ROOT)/IPlug/VST3
      GCC_PREPROCESSOR_DEFINITIONS:
        - $(inherited)
        - $(DEBUG_DEFS)
        - $(EXTRA_PLUGIN_DEFS)
        - $(EXTRA_VST3_DEFS)
        - $(VST3_DEFS)
        - $(EXTRA_ALL_DEFS)
        - $(ALL_DEFS)
    dependencies:
      - sdk: Cocoa.framework
      - sdk: Carbon.framework
      - sdk: CoreFoundation.framework
      - sdk: CoreServices.framework
      - sdk: QuartzCore.framework
      - sdk: Metal.framework
      - sdk: MetalKit.framework
      - sdk: OpenGL.framework
    sources: &plugin_sources
      # Project source files
      - path: .
        includes:
          - "*.cpp"
          - "*.h"
        excludes:
          - "*.md"
          - "*.RPP"
          - "project*.yml"
      # IPlug Core
      - path: ../../IPlug
        name: IPlug
        buildPhase: sources
        includes:
          - "IPlugAPIBase.cpp"
          - "IPlugParameter.cpp"
          - "IPlugPluginBase.cpp"
          - "IPlugProcessor.cpp"
          - "IPlugPaths.mm"
          - "IPlugTimer.cpp"
      # VST3 Implementation
      - path: ../../IPlug/VST3
        name: VST3
        buildPhase: sources
        includes:
          - "IPlugVST3.cpp"
          - "IPlugVST3_ProcessorBase.cpp"
      # VST3 SDK sources
      - path: ../../Dependencies/IPlug/VST3_SDK/base/source
        name: VST3_SDK_base
        buildPhase: sources
        includes:
          - "fobject.cpp"
          - "fdebug.cpp"
          - "updatehandler.cpp"
          - "fstreamer.cpp"
          - "fbuffer.cpp"
          - "fstring.cpp"
          - "timer.cpp"
          - "baseiids.cpp"
      - path: ../../Dependencies/IPlug/VST3_SDK/base/thread/source
        name: VST3_SDK_thread
        buildPhase: sources
        includes:
          - "*.cpp"
      - path: ../../Dependencies/IPlug/VST3_SDK/public.sdk/source/common
        name: VST3_SDK_common
        buildPhase: sources
        includes:
          - "pluginview.cpp"
          - "commoniids.cpp"
      - path: ../../Dependencies/IPlug/VST3_SDK/public.sdk/source/main
        name: VST3_SDK_main
        buildPhase: sources
        includes:
          - "pluginfactory.cpp"
      - path: ../../Dependencies/IPlug/VST3_SDK/public.sdk/source/vst
        name: VST3_SDK_vst
        buildPhase: sources
        includes:
          - "vstbus.cpp"
          - "vstcomponent.cpp"
          - "vstcomponentbase.cpp"
          - "vstaudioeffect.cpp"
          - "vstparameters.cpp"
          - "vstinitiids.cpp"
          - "vstsinglecomponenteffect.cpp"
          # Note: vsteditcontroller.cpp is included by vstsinglecomponenteffect.cpp
      - path: ../../Dependencies/IPlug/VST3_SDK/pluginterfaces/base
        name: VST3_SDK_pluginterfaces
        buildPhase: sources
        includes:
          - "coreiids.cpp"
          - "funknown.cpp"
          - "ustring.cpp"
      # IGraphics Core
      - path: ../../IGraphics
        name: IGraphics
        buildPhase: sources
        includes:
          - "IGraphics.cpp"
          - "IGraphicsEditorDelegate.cpp"
      # IGraphics Controls
      - path: ../../IGraphics/Controls
        name: Controls
        buildPhase: sources
        includes:
          - "IControls.cpp"
          - "ITextEntryControl.cpp"
          - "IPopupMenuControl.cpp"
      # IGraphics Platforms (macOS)
      - path: ../../IGraphics/Platforms
        name: Platforms
        buildPhase: sources
        includes:
          - "IGraphicsMac.mm"
          - "IGraphicsMac_view.mm"
          - "IGraphicsCoreText.mm"
      # IGraphics Drawing (NanoVG)
      # Note: IGraphicsNanoVG.cpp is #included by IGraphicsMac.mm - don't compile separately
      - path: ../../IGraphics/Drawing/IGraphicsNanoVG_src.m
        name: IGraphicsNanoVG_src.m
        buildPhase: sources
        compilerFlags: -fobjc-arc
      # SWELL
      - path: ../../WDL/swell
        name: SWELL
        buildPhase: sources
        includes:
          - "swell.cpp"
          - "swell-ini.cpp"
          - "swell-misc.mm"
          - "swell-gdi.mm"
          - "swell-kb.mm"
          - "swell-menu.mm"
          - "swell-wnd.mm"
          - "swell-dlg.mm"
          - "swell-miscdlg.mm"
      # Resources
      - path: resources/fonts
        name: fonts
        buildPhase: resources
    scheme: {}

  # CLAP Plugin
  CLAP:
    platform: macOS
    type: bundle
    settings:
      PRODUCT_NAME: $(BINARY_NAME)
      INFOPLIST_FILE: resources/IPlugEffect-CLAP-Info.plist
      WRAPPER_EXTENSION: clap
      DSTROOT: $(CLAP_PATH)
      INSTALL_PATH: /
      CODE_SIGN_IDENTITY: ""
      PRODUCT_BUNDLE_IDENTIFIER: com.AcmeInc.clap.$(BINARY_NAME)
      SKIP_INSTALL: NO
      GENERATE_PKGINFO_FILE: YES
      DEPLOYMENT_LOCATION: YES
      HEADER_SEARCH_PATHS:
        - $(inherited)
        - $(SRCROOT)
        - $(CLAP_INC_PATHS)
        - $(IPLUG2_ROOT)/IPlug/CLAP
      GCC_PREPROCESSOR_DEFINITIONS:
        - $(inherited)
        - $(DEBUG_DEFS)
        - $(EXTRA_PLUGIN_DEFS)
        - $(CLAP_DEFS)
        - $(EXTRA_ALL_DEFS)
        - $(ALL_DEFS)
    dependencies:
      - sdk: Cocoa.framework
      - sdk: Carbon.framework
      - sdk: CoreFoundation.framework
      - sdk: CoreServices.framework
      - sdk: QuartzCore.framework
      - sdk: Metal.framework
      - sdk: MetalKit.framework
      - sdk: OpenGL.framework
    sources:
      # Project source files
      - path: .
        includes:
          - "*.cpp"
          - "*.h"
        excludes:
          - "*.md"
          - "*.RPP"
          - "project*.yml"
      # IPlug Core
      - path: ../../IPlug
        name: IPlug
        buildPhase: sources
        includes:
          - "IPlugAPIBase.cpp"
          - "IPlugParameter.cpp"
          - "IPlugPluginBase.cpp"
          - "IPlugProcessor.cpp"
          - "IPlugPaths.mm"
          - "IPlugTimer.cpp"
      # CLAP Implementation
      - path: ../../IPlug/CLAP
        name: CLAP
        buildPhase: sources
        includes:
          - "IPlugCLAP.cpp"
      # IGraphics Core
      - path: ../../IGraphics
        name: IGraphics
        buildPhase: sources
        includes:
          - "IGraphics.cpp"
          - "IGraphicsEditorDelegate.cpp"
      # IGraphics Controls
      - path: ../../IGraphics/Controls
        name: Controls
        buildPhase: sources
        includes:
          - "IControls.cpp"
          - "ITextEntryControl.cpp"
          - "IPopupMenuControl.cpp"
      # IGraphics Platforms (macOS)
      - path: ../../IGraphics/Platforms
        name: Platforms
        buildPhase: sources
        includes:
          - "IGraphicsMac.mm"
          - "IGraphicsMac_view.mm"
          - "IGraphicsCoreText.mm"
      # IGraphics Drawing (NanoVG)
      # Note: IGraphicsNanoVG.cpp is #included by IGraphicsMac.mm - don't compile separately
      - path: ../../IGraphics/Drawing/IGraphicsNanoVG_src.m
        name: IGraphicsNanoVG_src.m
        buildPhase: sources
        compilerFlags: -fobjc-arc
      # SWELL
      - path: ../../WDL/swell
        name: SWELL
        buildPhase: sources
        includes:
          - "swell.cpp"
          - "swell-ini.cpp"
          - "swell-misc.mm"
          - "swell-gdi.mm"
          - "swell-kb.mm"
          - "swell-menu.mm"
          - "swell-wnd.mm"
          - "swell-dlg.mm"
          - "swell-miscdlg.mm"
      # Resources
      - path: resources/fonts
        name: fonts
        buildPhase: resources
    scheme: {}

  # AUv2 Plugin
  AUv2:
    platform: macOS
    type: bundle
    settings:
      PRODUCT_NAME: $(BINARY_NAME)
      INFOPLIST_FILE: resources/IPlugEffect-AU-Info.plist
      WRAPPER_EXTENSION: component
      DSTROOT: $(AU_PATH)
      INSTALL_PATH: /
      CODE_SIGN_IDENTITY: ""
      PRODUCT_BUNDLE_IDENTIFIER: com.AcmeInc.audiounit.$(BINARY_NAME)
      SKIP_INSTALL: NO
      GENERATE_PKGINFO_FILE: YES
      DEPLOYMENT_LOCATION: YES
      REZ_SEARCH_PATHS: $(SRCROOT) $(IPLUG_PATH) $(SDKROOT)/System/Library/Frameworks/CoreServices.framework/Versions/A/Frameworks/CarbonCore.framework/Versions/A/Headers
      HEADER_SEARCH_PATHS:
        - $(inherited)
        - $(SRCROOT)
        - $(IPLUG2_ROOT)/IPlug/AUv2
      GCC_PREPROCESSOR_DEFINITIONS:
        - $(inherited)
        - $(DEBUG_DEFS)
        - $(EXTRA_PLUGIN_DEFS)
        - $(EXTRA_AU_DEFS)
        - $(AU_DEFS)
        - $(EXTRA_ALL_DEFS)
        - $(ALL_DEFS)
    dependencies:
      - sdk: Cocoa.framework
      - sdk: Carbon.framework
      - sdk: CoreFoundation.framework
      - sdk: CoreServices.framework
      - sdk: QuartzCore.framework
      - sdk: AudioUnit.framework
      - sdk: AudioToolbox.framework
      - sdk: CoreAudio.framework
      - sdk: CoreMIDI.framework
      - sdk: Metal.framework
      - sdk: MetalKit.framework
      - sdk: OpenGL.framework
    sources:
      # Project source files
      - path: .
        includes:
          - "*.cpp"
          - "*.h"
        excludes:
          - "*.md"
          - "*.RPP"
          - "project*.yml"
      # IPlug Core
      - path: ../../IPlug
        name: IPlug
        buildPhase: sources
        includes:
          - "IPlugAPIBase.cpp"
          - "IPlugParameter.cpp"
          - "IPlugPluginBase.cpp"
          - "IPlugProcessor.cpp"
          - "IPlugPaths.mm"
          - "IPlugTimer.cpp"
      # AUv2 Implementation
      - path: ../../IPlug/AUv2
        name: AUv2
        buildPhase: sources
        includes:
          - "IPlugAU.cpp"
          - "IPlugAU_view_factory.mm"
          - "dfx-au-utilities.c"
      - path: ../../IPlug/AUv2/IPlugAU.r
        name: IPlugAU.r
        buildPhase: sources
      # IGraphics Core
      - path: ../../IGraphics
        name: IGraphics
        buildPhase: sources
        includes:
          - "IGraphics.cpp"
          - "IGraphicsEditorDelegate.cpp"
      # IGraphics Controls
      - path: ../../IGraphics/Controls
        name: Controls
        buildPhase: sources
        includes:
          - "IControls.cpp"
          - "ITextEntryControl.cpp"
          - "IPopupMenuControl.cpp"
      # IGraphics Platforms (macOS)
      - path: ../../IGraphics/Platforms
        name: Platforms
        buildPhase: sources
        includes:
          - "IGraphicsMac.mm"
          - "IGraphicsMac_view.mm"
          - "IGraphicsCoreText.mm"
      # IGraphics Drawing (NanoVG)
      # Note: IGraphicsNanoVG.cpp is #included by IGraphicsMac.mm - don't compile separately
      - path: ../../IGraphics/Drawing/IGraphicsNanoVG_src.m
        name: IGraphicsNanoVG_src.m
        buildPhase: sources
        compilerFlags: -fobjc-arc
      # SWELL
      - path: ../../WDL/swell
        name: SWELL
        buildPhase: sources
        includes:
          - "swell.cpp"
          - "swell-ini.cpp"
          - "swell-misc.mm"
          - "swell-gdi.mm"
          - "swell-kb.mm"
          - "swell-menu.mm"
          - "swell-wnd.mm"
          - "swell-dlg.mm"
          - "swell-miscdlg.mm"
      # Resources
      - path: resources/fonts
        name: fonts
        buildPhase: resources
    scheme: {}

  # Standalone Application
  APP:
    platform: macOS
    type: application
    settings:
      PRODUCT_NAME: $(BINARY_NAME)
      INFOPLIST_FILE: resources/IPlugEffect-macOS-Info.plist
      DSTROOT: $(APP_PATH)
      INSTALL_PATH: /
      ENABLE_HARDENED_RUNTIME: YES
      CODE_SIGN_ENTITLEMENTS: projects/IPlugEffect-macOS.entitlements
      LD_RUNPATH_SEARCH_PATHS: "@executable_path/../Frameworks"
      HEADER_SEARCH_PATHS:
        - $(inherited)
        - $(SRCROOT)
        - $(IPLUG2_ROOT)/IPlug/APP
      GCC_PREPROCESSOR_DEFINITIONS:
        - $(inherited)
        - $(DEBUG_DEFS)
        - $(EXTRA_APP_DEFS)
        - $(APP_DEFS)
        - $(EXTRA_ALL_DEFS)
        - $(ALL_DEFS)
    dependencies:
      - sdk: Cocoa.framework
      - sdk: Carbon.framework
      - sdk: CoreFoundation.framework
      - sdk: CoreServices.framework
      - sdk: QuartzCore.framework
      - sdk: AppKit.framework
      - sdk: CoreMIDI.framework
      - sdk: CoreAudio.framework
      - sdk: Metal.framework
      - sdk: MetalKit.framework
      - sdk: OpenGL.framework
    sources:
      # Project source files
      - path: .
        includes:
          - "*.cpp"
          - "*.h"
        excludes:
          - "*.md"
          - "*.RPP"
          - "project*.yml"
      # IPlug Core
      - path: ../../IPlug
        name: IPlug
        buildPhase: sources
        includes:
          - "IPlugAPIBase.cpp"
          - "IPlugParameter.cpp"
          - "IPlugPluginBase.cpp"
          - "IPlugProcessor.cpp"
          - "IPlugPaths.mm"
          - "IPlugTimer.cpp"
      # APP Implementation
      - path: ../../IPlug/APP
        name: APP
        buildPhase: sources
        includes:
          - "IPlugAPP.cpp"
          - "IPlugAPP_host.cpp"
          - "IPlugAPP_dialog.cpp"
      # IPlugAPP_main.cpp needs Objective-C++ for Cocoa.h
      - path: ../../IPlug/APP/IPlugAPP_main.cpp
        name: IPlugAPP_main.cpp
        buildPhase: sources
        compilerFlags: -x objective-c++
      # RtAudio/RtMidi for standalone audio
      - path: ../../Dependencies/IPlug/RTAudio/RtAudio.cpp
        name: RtAudio.cpp
        buildPhase: sources
        compilerFlags: -x objective-c++
      - path: ../../Dependencies/IPlug/RTMidi/RtMidi.cpp
        name: RtMidi.cpp
        buildPhase: sources
        compilerFlags: -x objective-c++
      # IGraphics Core
      - path: ../../IGraphics
        name: IGraphics
        buildPhase: sources
        includes:
          - "IGraphics.cpp"
          - "IGraphicsEditorDelegate.cpp"
      # IGraphics Controls
      - path: ../../IGraphics/Controls
        name: Controls
        buildPhase: sources
        includes:
          - "IControls.cpp"
          - "ITextEntryControl.cpp"
          - "IPopupMenuControl.cpp"
      # IGraphics Platforms (macOS)
      - path: ../../IGraphics/Platforms
        name: Platforms
        buildPhase: sources
        includes:
          - "IGraphicsMac.mm"
          - "IGraphicsMac_view.mm"
          - "IGraphicsCoreText.mm"
      # IGraphics Drawing (NanoVG)
      # Note: IGraphicsNanoVG.cpp is #included by IGraphicsMac.mm - don't compile separately
      - path: ../../IGraphics/Drawing/IGraphicsNanoVG_src.m
        name: IGraphicsNanoVG_src.m
        buildPhase: sources
        compilerFlags: -fobjc-arc
      # SWELL
      - path: ../../WDL/swell
        name: SWELL
        buildPhase: sources
        includes:
          - "swell.cpp"
          - "swell-ini.cpp"
          - "swell-misc.mm"
          - "swell-gdi.mm"
          - "swell-kb.mm"
          - "swell-menu.mm"
          - "swell-wnd.mm"
          - "swell-dlg.mm"
          - "swell-miscdlg.mm"
      # Resources
      - path: resources
        name: Resources
        buildPhase: resources
        includes:
          - "IPlugEffect-macOS-MainMenu.xib"
          - "IPlugEffect.icns"
          - "Images.xcassets"
          - "fonts"
    scheme: {}

############################################
# Schemes
############################################
schemes:
  All-macOS:
    build:
      targets:
        VST3: all
        CLAP: all
        AUv2: all
        APP: all
